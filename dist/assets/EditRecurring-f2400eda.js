import{S as nt,i as rt,s as st,a4 as ot,a5 as it,c as at,m as ct,a6 as ut,j as lt,t as mt,l as pt,X as r,O as dt,Z as o,q as S,p as ht,P as ft}from"./Toaster.svelte_svelte_type_style_lang-3086cbd0.js";import{g as bt}from"./options-89ca2928.js";import{B as yt}from"./BaseCreateRecurring-c77a39ac.js";import{i as gt,v as Ct,w as Dt,h as fe}from"./errorHelper-eef9e97b.js";import{k as Pt,d as be,b as ye,r as ge,o as Ce,g as De,t as Bt,f as Pe,p as _t,v as kt,x as Rt,y as Be,e as _e,z as ke,A as Re,q as ve,u as Fe,h as Te,l as vt,I as ee,s as N,B as Ae,C as Ie,D as Se,E as Ne,F as qe,G as xe,j as Ee,H as we,a as Le,c as We}from"./invoice-store-89da11de.js";import{r as Xe}from"./recurring-store-e654427c.js";import{P as te}from"./enum-9d62bdc6.js";import{c as je}from"./capitalHelper-77c0a756.js";import{s as Ft,c as Tt}from"./Options-60264e68.js";import"./updater-cbd8223a.js";import"./index-2f32262e.js";import"./x-e55b9835.js";import"./main-2325799b.js";import"./index-0984da6d.js";import"./emptyDataHelper-b583dd0c.js";import"./index-7095afc4.js";import"./arrays-9d05857f.js";import"./Check-fa20f0eb.js";import"./action-39728114.js";import"./helpers-9268112f.js";import"./create-e552ce8d.js";import"./separator-d7b15c7c.js";import"./label-7d3a217f.js";import"./styles-e7e55f44.js";import"./input-342b31a9.js";import"./header-title-a9af6ef4.js";import"./Breadcrumb-8a216a28.js";import"./ProBadge-35078e4e.js";import"./plus-a3b54817.js";import"./table-row-9bf80d0a.js";import"./card-footer-7cfda621.js";import"./index-d3c8ba18.js";import"./MiniStar-4e4614b7.js";import"./Plus-e1a813d4.js";import"./Trash-c1f21d44.js";import"./Select-aaeb8f73.js";import"./decimalFormatter-88348579.js";import"./saveToStoreHelper-e7988ee0.js";import"./MultilineText-07aaf54e.js";import"./dialog-header-208ee491.js";import"./dialog-footer-e40dcf9d.js";import"./dialog-description-776c5d22.js";import"./dialog-description-42b79c51.js";import"./customer-modal-96845865.js";import"./switch-b7e944c0.js";import"./product-modal-3f3c8373.js";import"./CustomCurrencyInput-d3541a18.js";import"./search-b20aeeac.js";import"./checkbox-3eb65d0a.js";import"./index-4f0b7d19.js";import"./card-description-e849d062.js";import"./pluralHelper-a32d0151.js";import"./add-discount-modal-7bc175c5.js";import"./add-tax-modal-c2b7393b.js";import"./add-reminder-modal-6c4f373e.js";import"./UpgradeToProButton-e020fdbc.js";import"./chevron-down-a8868dd9.js";function At(n){let l,t,m;function P(c){n[18](c)}let y={isEdit:!0,nav:n[2],isSubmitting:n[1]};return n[0]!==void 0&&(y.selectedDueDateBind=n[0]),l=new yt({props:y}),ot.push(()=>it(l,"selectedDueDateBind",P)),l.$on("settingsFetched",n[5]),l.$on("submit",n[4]),l.$on("updateDueDate",n[3]),{c(){at(l.$$.fragment)},m(c,p){ct(l,c,p),m=!0},p(c,p){const h={};p[0]&2&&(h.isSubmitting=c[1]),!t&&p[0]&1&&(t=!0,h.selectedDueDateBind=c[0],ut(()=>t=!1)),l.$set(h)},i(c){m||(lt(l.$$.fragment,c),m=!0)},o(c){mt(l.$$.fragment,c),m=!1},d(c){pt(l,c)}}}function It(n,l,t){let m,P,y,c,p,h,g,ne,C,re,se,oe,D,R,v,F,B,_,k,q,f,u,i,x,E,w,L,W,X,j,z,O,G,M,H;r(n,Pt,e=>t(21,m=e)),r(n,gt,e=>t(22,P=e)),r(n,be,e=>t(23,y=e)),r(n,ye,e=>t(24,c=e)),r(n,ge,e=>t(25,p=e)),r(n,Ce,e=>t(26,h=e)),r(n,De,e=>t(14,g=e)),r(n,Bt,e=>t(27,ne=e)),r(n,Pe,e=>t(15,C=e)),r(n,_t,e=>t(28,re=e)),r(n,kt,e=>t(29,se=e)),r(n,Rt,e=>t(30,oe=e)),r(n,Be,e=>t(31,D=e)),r(n,_e,e=>t(32,R=e)),r(n,ke,e=>t(33,v=e)),r(n,Re,e=>t(34,F=e)),r(n,ve,e=>t(35,B=e)),r(n,Fe,e=>t(36,_=e)),r(n,Te,e=>t(37,k=e)),r(n,vt,e=>t(38,q=e)),r(n,ee,e=>t(39,f=e)),r(n,N,e=>t(40,u=e)),r(n,Xe,e=>t(41,i=e)),r(n,Ae,e=>t(42,x=e)),r(n,Ie,e=>t(43,E=e)),r(n,Se,e=>t(44,w=e)),r(n,Ne,e=>t(45,L=e)),r(n,qe,e=>t(46,W=e)),r(n,xe,e=>t(47,X=e)),r(n,Ee,e=>t(48,j=e)),r(n,we,e=>t(49,z=e)),r(n,Ct,e=>t(16,O=e)),r(n,Le,e=>t(50,G=e)),r(n,Dt,e=>t(17,M=e)),r(n,We,e=>t(51,H=e));let{params:K={}}=l;const ze=[{name:"Recurring",link:"recurrings"},{name:"Edit",link:""}];let ie,U,T,V,Y,Z,J=!1,Q=!1,$=!1,A=!1;const ae=(e,s)=>e.map(d=>!!s.find(I=>I.name===d.name)),Oe=e=>{const s={label:e.name,value:e};return s.value.isWcClient==="true"||s.value.isWcClient===!0?s.value.isWcClient=!0:s.value.isWcClient=!1,s.value.id=parseInt(s.value.id),s},Ge=e=>{const s=bt.find(b=>b.id===parseInt(e));if(!s){const b={value:0,label:"Custom"};return o(N,u=b,u),o(ee,f=parseInt(e),f),b}const d={value:s.id,label:s.name};return o(N,u=d,u),d},Me=e=>({name:e.name,interval:{value:e.interval,label:je(e.interval)},start_date:e.nextInvoiceDate,end:{value:e.end,label:je(e.end)}}),ce=e=>e==null?void 0:e.map(s=>`${s.value} ${s.interval}`),ue=e=>{var d,b,I,le,me,pe,de,he;ie=e.id,o(we,z={label:e.invoice.business.business_name,value:e.invoice.business},z),o(Ee,j=Oe(e.invoice.client),j),t(0,T=Ge(e.invoice.dueDateInterval)),o(Te,k=e.invoice.products.map(a=>({id:parseInt(a.id),name:a.name,quantity:parseInt(a.quantity),unitPrice:parseFloat(a.unitPrice),amount:parseFloat(a.amount),description:a.description,note:a.note})),k),e.invoice.payments.map(a=>{a.method===te.BANK?(o(xe,X=!0,X),o(qe,W={label:a.name,value:{id:a.id,name:a.name,type:a.type,detail:a.detail,currency:{name:a.currency}}},W)):a.method===te.PAYPAL?(o(Ne,L=!0,L),o(Se,w={label:a.type,value:{name:a.name,type:a.type}},w),o(Ie,E={name:a.name,type:a.type},E)):a.method===te.XENDIT&&o(Ae,x=!0,x)}),o(Fe,_=e.invoice.billedTo,_),o(ve,B=e.invoice.billedToSameAsClient,B),o(Re,F=e.invoice.invoiceNote.note,F),o(ke,v=e.invoice.invoiceNote.terms,v),o(_e,R=e.invoice.invoiceNote.internalNote,R),o(Pe,C=e.invoice.discount.data,C),o(De,g=e.invoice.tax.data,g),t(10,Z=e.invoice.currency),t(8,V=ce((b=(d=e.invoice)==null?void 0:d.reminders)==null?void 0:b.before)??[]),t(9,Y=ce((le=(I=e.invoice)==null?void 0:I.reminders)==null?void 0:le.after)??[]),o(Xe,i=Me(e.recurring),i);const s=((me=e==null?void 0:e.reminders)==null?void 0:me.before)||((pe=e==null?void 0:e.reminders)==null?void 0:pe.after);o(ge,p=((de=e.invoice.reminders)==null?void 0:de.forAdmin)??!1,p),o(Ce,h=((he=e.invoice.reminders)==null?void 0:he.forClient)??s,h)},He=async()=>{try{const e=await ft(`recurring/detail?token=${K.invoizeToken}`);P&&console.log(e.data),t(7,U=e.data),ue(e.data),t(12,Q=!0)}catch(e){fe(e,"Failed to retrieve recurring data")}},Ke=e=>{o(N,u=e.detail,u),e.detail.value===0||(e.detail.value,o(ee,f=null,f))},Ue=()=>{var e,s;return!((e=i==null?void 0:i.name)!=null&&e.trim())||!((s=i==null?void 0:i.interval)!=null&&s.value)||!(i!=null&&i.start_date)||!(i!=null&&i.end)},Ve=()=>{let e=[];if(q||e.push("Issuer"),(!m||m.id===0)&&e.push("Customer"),(f==0||f==null&&(u==null?void 0:u.value)==0)&&e.push("Due date"),k.length===0&&e.push("Product"),Tt()||e.push("Payment method"),(!D||D.name==="none")&&e.push("Currency"),!B&&!_.name&&e.push("Bill to 'name'"),Ue()&&e.push("Recurring"),e.length>0){const s="Please fill missing fields: "+e.join(", ")+".";return S.error(s),!1}return!0},Ye=()=>{var e,s;return{name:i==null?void 0:i.name,interval:(e=i==null?void 0:i.interval)==null?void 0:e.value,start:i==null?void 0:i.start_date,end:(s=i==null?void 0:i.end)==null?void 0:s.value}},Ze=()=>(u==null?void 0:u.value)!==0?parseInt(u==null?void 0:u.value):parseInt(f),Je=(e,s,d)=>({id:ie,business:q,client:m,dueDateInterval:d,products:k,billedTo:_,billedToSameAsClient:B,payments:e,note:F,terms:v,internalNote:R,currency:D,subtotal:oe,total:se,discount:{total:re,data:C},tax:{total:ne,data:g},reminder:{forClient:h,forAdmin:p,before:c,after:y},recurring:s}),Qe=()=>{Ve()&&$e(Je(Ft(),Ye(),Ze()))},$e=e=>{P&&console.log(e),t(1,A=!0),S.loading("Updating recurring invoice..."),ht("recurring/edit",e,s=>{S.dismiss(),t(1,A=!1),S.success("Recurring Invoice updated successfully"),window.location.replace(`#/recurring/${m.id}/${s.data.token}`)}).catch(s=>{t(1,A=!1),fe(s,"Failed to update recurring invoice")})},et=()=>{t(11,J=!0)};dt(()=>{He()});function tt(e){T=e,t(0,T)}return n.$$set=e=>{"params"in e&&t(6,K=e.params)},n.$$.update=()=>{n.$$.dirty[0]&262016&&J&&Q&&!$&&(o(ye,c=V,c),o(be,y=Y,y),o(Be,D=Z,D),o(We,H=ae(M,g),H),o(Le,G=ae(O,C),G),ue(U),t(13,$=!0))},[T,A,ze,Ke,Qe,et,K,U,V,Y,Z,J,Q,$,g,C,O,M,tt]}class En extends nt{constructor(l){super(),rt(this,l,It,At,st,{params:6},null,[-1,-1,-1])}}export{En as default};
