import{S as it,i as at,s as ct,a4 as ut,a5 as lt,c as mt,m as pt,a6 as dt,j as ht,t as bt,l as ft,X as r,O as yt,Z as o,q as S,p as gt,P as Ct}from"./Toaster.svelte_svelte_type_style_lang-3086cbd0.js";import{g as Dt}from"./options-89ca2928.js";import{B as Pt}from"./BaseCreateRecurring-e1036462.js";import{i as Bt,v as _t,w as kt,h as Ce}from"./errorHelper-eef9e97b.js";import{k as Rt,d as De,b as Pe,r as Be,o as _e,g as ke,t as vt,f as Re,p as Tt,v as Ft,x as At,y as ve,e as Te,z as Fe,A as Ae,q as Ie,u as Se,h as Ne,l as It,I as ee,s as N,B as qe,C as xe,D as Ee,E as we,F as Le,G as We,j as Xe,H as je,a as ze,c as Oe}from"./invoice-store-89da11de.js";import{r as Ge}from"./recurring-store-e654427c.js";import{P as te}from"./enum-9d62bdc6.js";import{c as Me}from"./capitalHelper-77c0a756.js";import{s as St,c as Nt}from"./Options-60264e68.js";import"./updater-cbd8223a.js";import"./index-2f32262e.js";import"./x-e55b9835.js";import"./main-380bbcc3.js";import"./index-0984da6d.js";import"./emptyDataHelper-b583dd0c.js";import"./index-7095afc4.js";import"./arrays-9d05857f.js";import"./Check-fa20f0eb.js";import"./action-39728114.js";import"./helpers-9268112f.js";import"./create-e552ce8d.js";import"./separator-d7b15c7c.js";import"./label-7d3a217f.js";import"./styles-e7e55f44.js";import"./input-342b31a9.js";import"./header-title-a9af6ef4.js";import"./Breadcrumb-8a216a28.js";import"./ProBadge-35078e4e.js";import"./plus-a3b54817.js";import"./table-row-9bf80d0a.js";import"./card-footer-7cfda621.js";import"./index-d3c8ba18.js";import"./MiniStar-4e4614b7.js";import"./Plus-e1a813d4.js";import"./Trash-c1f21d44.js";import"./Select-aaeb8f73.js";import"./decimalFormatter-88348579.js";import"./saveToStoreHelper-e7988ee0.js";import"./MultilineText-07aaf54e.js";import"./dialog-header-208ee491.js";import"./dialog-footer-e40dcf9d.js";import"./dialog-description-776c5d22.js";import"./dialog-description-42b79c51.js";import"./customer-modal-96845865.js";import"./switch-b7e944c0.js";import"./product-modal-3f3c8373.js";import"./CustomCurrencyInput-d3541a18.js";import"./search-b20aeeac.js";import"./checkbox-3eb65d0a.js";import"./index-4f0b7d19.js";import"./card-description-e849d062.js";import"./pluralHelper-a32d0151.js";import"./add-discount-modal-7bc175c5.js";import"./add-tax-modal-c2b7393b.js";import"./add-reminder-modal-6c4f373e.js";import"./UpgradeToProButton-e020fdbc.js";import"./chevron-down-a8868dd9.js";function qt(n){let l,t,m;function P(c){n[18](c)}let y={isEdit:!0,nav:n[2],isSubmitting:n[1]};return n[0]!==void 0&&(y.selectedDueDateBind=n[0]),l=new Pt({props:y}),ut.push(()=>lt(l,"selectedDueDateBind",P)),l.$on("settingsFetched",n[5]),l.$on("submit",n[4]),l.$on("updateDueDate",n[3]),{c(){mt(l.$$.fragment)},m(c,p){pt(l,c,p),m=!0},p(c,p){const h={};p[0]&2&&(h.isSubmitting=c[1]),!t&&p[0]&1&&(t=!0,h.selectedDueDateBind=c[0],dt(()=>t=!1)),l.$set(h)},i(c){m||(ht(l.$$.fragment,c),m=!0)},o(c){bt(l.$$.fragment,c),m=!1},d(c){ft(l,c)}}}function xt(n,l,t){let m,P,y,c,p,h,g,ne,C,re,se,oe,D,R,v,T,B,_,k,q,b,u,i,x,E,w,L,W,X,j,z,O,G,M,H;r(n,Rt,e=>t(21,m=e)),r(n,Bt,e=>t(22,P=e)),r(n,De,e=>t(23,y=e)),r(n,Pe,e=>t(24,c=e)),r(n,Be,e=>t(25,p=e)),r(n,_e,e=>t(26,h=e)),r(n,ke,e=>t(14,g=e)),r(n,vt,e=>t(27,ne=e)),r(n,Re,e=>t(15,C=e)),r(n,Tt,e=>t(28,re=e)),r(n,Ft,e=>t(29,se=e)),r(n,At,e=>t(30,oe=e)),r(n,ve,e=>t(31,D=e)),r(n,Te,e=>t(32,R=e)),r(n,Fe,e=>t(33,v=e)),r(n,Ae,e=>t(34,T=e)),r(n,Ie,e=>t(35,B=e)),r(n,Se,e=>t(36,_=e)),r(n,Ne,e=>t(37,k=e)),r(n,It,e=>t(38,q=e)),r(n,ee,e=>t(39,b=e)),r(n,N,e=>t(40,u=e)),r(n,Ge,e=>t(41,i=e)),r(n,qe,e=>t(42,x=e)),r(n,xe,e=>t(43,E=e)),r(n,Ee,e=>t(44,w=e)),r(n,we,e=>t(45,L=e)),r(n,Le,e=>t(46,W=e)),r(n,We,e=>t(47,X=e)),r(n,Xe,e=>t(48,j=e)),r(n,je,e=>t(49,z=e)),r(n,_t,e=>t(16,O=e)),r(n,ze,e=>t(50,G=e)),r(n,kt,e=>t(17,M=e)),r(n,Oe,e=>t(51,H=e));let{params:K={}}=l;const He=[{name:"Recurring",link:"recurrings"},{name:"Edit",link:""}];let ie,U,F,V,Y,Z,J=!1,Q=!1,$=!1,A=!1;const ae=(e,s)=>e.map(d=>!!s.find(I=>I.name===d.name)),Ke=e=>{const s={label:e.name,value:e};return s.value.isWcClient==="true"||s.value.isWcClient===!0?s.value.isWcClient=!0:s.value.isWcClient=!1,s.value.id=parseInt(s.value.id),s},Ue=e=>{const s=Dt.find(f=>f.id===parseInt(e));if(!s){const f={value:0,label:"Custom"};return o(N,u=f,u),o(ee,b=parseInt(e),b),f}const d={value:s.id,label:s.name};return o(N,u=d,u),d},Ve=e=>({name:e.name,interval:{value:e.interval,label:Me(e.interval)},start_date:e.nextInvoiceDate,end:{value:e.end,label:Me(e.end)}}),ce=e=>e==null?void 0:e.map(s=>`${s.value} ${s.interval}`),ue=e=>{var d,f,I,le,me,pe,de,he,be,fe,ye,ge;ie=e.id,o(je,z={label:e.invoice.business.business_name,value:e.invoice.business},z),o(Xe,j=Ke(e.invoice.client),j),t(0,F=Ue(e.invoice.dueDateInterval)),o(Ne,k=e.invoice.products.map(a=>({id:parseInt(a.id),name:a.name,quantity:parseInt(a.quantity),unitPrice:parseFloat(a.unitPrice),amount:parseFloat(a.amount),description:a.description,note:a.note})),k),e.invoice.payments.map(a=>{a.method===te.BANK?(o(We,X=!0,X),o(Le,W={label:a.name,value:{id:a.id,name:a.name,type:a.type,detail:a.detail,currency:{name:a.currency}}},W)):a.method===te.PAYPAL?(o(we,L=!0,L),o(Ee,w={label:a.type,value:{name:a.name,type:a.type}},w),o(xe,E={name:a.name,type:a.type},E)):a.method===te.XENDIT&&o(qe,x=!0,x)}),o(Se,_={name:(f=(d=e.invoice)==null?void 0:d.billedTo)==null?void 0:f.name,detail:(le=(I=e.invoice)==null?void 0:I.billedTo)==null?void 0:le.detail},_),o(Ie,B=e.invoice.billedToSameAsClient,B),o(Ae,T=e.invoice.invoiceNote.note,T),o(Fe,v=e.invoice.invoiceNote.terms,v),o(Te,R=e.invoice.invoiceNote.internalNote,R),o(Re,C=e.invoice.discount.data,C),o(ke,g=e.invoice.tax.data,g),t(10,Z=e.invoice.currency),t(8,V=ce((pe=(me=e.invoice)==null?void 0:me.reminders)==null?void 0:pe.before)??[]),t(9,Y=ce((he=(de=e.invoice)==null?void 0:de.reminders)==null?void 0:he.after)??[]),o(Ge,i=Ve(e.recurring),i);const s=((be=e==null?void 0:e.reminders)==null?void 0:be.before)||((fe=e==null?void 0:e.reminders)==null?void 0:fe.after);o(Be,p=((ye=e.invoice.reminders)==null?void 0:ye.forAdmin)??!1,p),o(_e,h=((ge=e.invoice.reminders)==null?void 0:ge.forClient)??s,h)},Ye=async()=>{try{const e=await Ct(`recurring/detail?token=${K.invoizeToken}`);P&&console.log(e.data),t(7,U=e.data),ue(e.data),t(12,Q=!0)}catch(e){Ce(e,"Failed to retrieve recurring data")}},Ze=e=>{o(N,u=e.detail,u),e.detail.value===0||(e.detail.value,o(ee,b=null,b))},Je=()=>{var e,s;return!((e=i==null?void 0:i.name)!=null&&e.trim())||!((s=i==null?void 0:i.interval)!=null&&s.value)||!(i!=null&&i.start_date)||!(i!=null&&i.end)},Qe=()=>{let e=[];if(q||e.push("Issuer"),(!m||m.id===0)&&e.push("Customer"),(b==0||b==null&&(u==null?void 0:u.value)==0)&&e.push("Due date"),k.length===0&&e.push("Product"),Nt()||e.push("Payment method"),(!D||D.name==="none")&&e.push("Currency"),!B&&!_.name&&e.push("Bill to 'name'"),Je()&&e.push("Recurring"),e.length>0){const s="Please fill missing fields: "+e.join(", ")+".";return S.error(s),!1}return!0},$e=()=>{var e,s;return{name:i==null?void 0:i.name,interval:(e=i==null?void 0:i.interval)==null?void 0:e.value,start:i==null?void 0:i.start_date,end:(s=i==null?void 0:i.end)==null?void 0:s.value}},et=()=>(u==null?void 0:u.value)!==0?parseInt(u==null?void 0:u.value):parseInt(b),tt=(e,s,d)=>({id:ie,business:q,client:m,dueDateInterval:d,products:k,billedTo:_,billedToSameAsClient:B,payments:e,note:T,terms:v,internalNote:R,currency:D,subtotal:oe,total:se,discount:{total:re,data:C},tax:{total:ne,data:g},reminder:{forClient:h,forAdmin:p,before:c,after:y},recurring:s}),nt=()=>{Qe()&&rt(tt(St(),$e(),et()))},rt=e=>{P&&console.log(e),t(1,A=!0),S.loading("Updating recurring invoice..."),gt("recurring/edit",e,s=>{S.dismiss(),t(1,A=!1),S.success("Recurring Invoice updated successfully"),window.location.replace(`#/recurring/${m.id}/${s.data.token}`)}).catch(s=>{t(1,A=!1),Ce(s,"Failed to update recurring invoice")})},st=()=>{t(11,J=!0)};yt(()=>{Ye()});function ot(e){F=e,t(0,F)}return n.$$set=e=>{"params"in e&&t(6,K=e.params)},n.$$.update=()=>{n.$$.dirty[0]&262016&&J&&Q&&!$&&(o(Pe,c=V,c),o(De,y=Y,y),o(ve,D=Z,D),o(Oe,H=ae(M,g),H),o(ze,G=ae(O,C),G),ue(U),t(13,$=!0))},[F,A,He,Ze,nt,st,K,U,V,Y,Z,J,Q,$,g,C,O,M,ot]}class Xn extends it{constructor(l){super(),at(this,l,xt,qt,ct,{params:6},null,[-1,-1,-1])}}export{Xn as default};
