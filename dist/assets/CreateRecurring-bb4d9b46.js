import{S as re,i as oe,s as ie,a4 as se,a5 as ne,c as ae,m as me,a6 as ue,j as ce,t as le,l as de,X as i,aK as pe,O as fe,Z as _,a3 as ge,q as l,p as be}from"./Toaster.svelte_svelte_type_style_lang-89e761ff.js";import{t as Ce}from"./triggerTabUpdateHelper-d930696b.js";import{c as v}from"./enum-9d62bdc6.js";import{y as De,h as _e,s as x,I as z,k as he,l as Re,d as Se,b as ye,r as Ie,o as Ae,g as Be,t as Pe,f as Te,p as ke,v as Ee,x as Fe,e as Le,z as Ne,A as qe,q as we,u as Oe}from"./invoice-store-eba4366e.js";import{r as K,i as M}from"./recurring-store-561539e7.js";import{h as je}from"./invoiceErrorHelper-d5e44338.js";import{s as Ue,c as We}from"./Options-40a61ab3.js";import{i as ve}from"./errorHelper-39e9d1d7.js";import{B as xe}from"./BaseCreateRecurring-5b22a73d.js";import{g as ze}from"./setDefaultRecurring-f1d67430.js";import"./invoice-list-store-0e2f6016.js";import"./index-99d0c2fd.js";import"./table-row-f15328e9.js";import"./card-footer-08d9ee18.js";import"./index-700ffd0e.js";import"./updater-00e9e1bb.js";import"./options-1651b5d0.js";import"./x-416feb5b.js";import"./helpers-9eb8762f.js";import"./separator-95c0d010.js";import"./MiniStar-8026f138.js";import"./input-ab223ce3.js";import"./label-e50396f8.js";import"./create-9e47477b.js";import"./Plus-3897747b.js";import"./Trash-4a47b42d.js";import"./Select-70747da0.js";import"./index-210676e1.js";import"./arrays-9d05857f.js";import"./Check-a4797a61.js";import"./action-a5acf0e9.js";import"./styles-e7e55f44.js";import"./decimalFormatter-88348579.js";import"./saveToStoreHelper-31a463b7.js";import"./MultilineText-89cdd008.js";import"./dialog-header-5fe8b5ad.js";import"./dialog-footer-37c988b6.js";import"./dialog-description-ca00c0bf.js";import"./dialog-description-624b4ce9.js";import"./customer-modal-284e029d.js";import"./switch-8efa315f.js";import"./product-modal-e47dc535.js";import"./CustomCurrencyInput-e534ba6a.js";import"./capitalHelper-77c0a756.js";import"./search-e03ceb6e.js";import"./checkbox-ac399b75.js";import"./emptyDataHelper-b583dd0c.js";import"./index-88943f30.js";import"./card-description-236c99a6.js";import"./pluralHelper-a32d0151.js";import"./add-discount-modal-079529d2.js";import"./index-838f84b3.js";import"./add-tax-modal-3fd5671f.js";import"./add-reminder-modal-0bbf6d3f.js";import"./UpgradeToProButton-1dc6d5d7.js";import"./chevron-down-2b9a232f.js";import"./main-f1d8723f.js";import"./header-title-695fb230.js";import"./Breadcrumb-87f5fc70.js";import"./ProBadge-06425ff7.js";import"./plus-24a3e3c4.js";import"./moment-a9aaa855.js";function Ke(t){let a,r,o;function b(s){t[7](s)}let d={nav:t[2],isSubmitting:t[1]};return t[0]!==void 0&&(d.selectedDueDateBind=t[0]),a=new xe({props:d}),se.push(()=>ne(a,"selectedDueDateBind",b)),a.$on("submit",t[4]),a.$on("createInvoice",t[5]),a.$on("updateDueDate",t[3]),{c(){ae(a.$$.fragment)},m(s,u){me(a,s,u),o=!0},p(s,u){const n={};u[0]&2&&(n.isSubmitting=s[1]),!r&&u[0]&1&&(r=!0,n.selectedDueDateBind=s[0],ue(()=>r=!1)),a.$set(n)},i(s){o||(ce(a.$$.fragment,s),o=!0)},o(s){le(a.$$.fragment,s),o=!1},d(s){de(a,s)}}}function Me(t,a,r){let o,b,d,s,u,n,p,C,h,y,I,A,B,P,T,k,E,F,L,N,q,w,O,j;i(t,K,e=>r(10,o=e)),i(t,ve,e=>r(11,b=e)),i(t,M,e=>r(12,d=e)),i(t,De,e=>r(13,s=e)),i(t,_e,e=>r(14,u=e)),i(t,x,e=>r(15,n=e)),i(t,z,e=>r(16,p=e)),i(t,he,e=>r(17,C=e)),i(t,Re,e=>r(18,h=e)),i(t,Se,e=>r(19,y=e)),i(t,ye,e=>r(20,I=e)),i(t,Ie,e=>r(21,A=e)),i(t,Ae,e=>r(22,B=e)),i(t,Be,e=>r(23,P=e)),i(t,Pe,e=>r(24,T=e)),i(t,Te,e=>r(25,k=e)),i(t,ke,e=>r(26,E=e)),i(t,Ee,e=>r(27,F=e)),i(t,Fe,e=>r(28,L=e)),i(t,Le,e=>r(29,N=e)),i(t,Ne,e=>r(30,q=e)),i(t,qe,e=>r(31,w=e)),i(t,we,e=>r(32,O=e)),i(t,Oe,e=>r(33,j=e));let{params:f={}}=a;const V=[{name:"Recurring",link:"recurrings"},{name:"Create",link:""}];let R,D=!1,U=!1;pe("clientIdParam",f==null?void 0:f.clientId);const X=()=>{var e,m;return{name:o==null?void 0:o.name,interval:(e=o==null?void 0:o.interval)==null?void 0:e.value,start:o==null?void 0:o.start_date,end:(m=o==null?void 0:o.end)==null?void 0:m.value}},Z=()=>(n==null?void 0:n.value)!==0?parseInt(n==null?void 0:n.value):parseInt(p),G=(e,m,g)=>({id:m.name,business:h,billedTo:j,billedToSameAsClient:O,client:C,dueDateInterval:g,products:u,payments:e,note:w,terms:q,internalNote:N,currency:s,subtotal:L,total:F,discount:{total:E,data:k},tax:{total:T,data:P},reminder:{forClient:B,forAdmin:A,before:I,after:y},recurring:m}),H=e=>{_(x,n=e.detail,n),e.detail.value===0?J():(e.detail.value,_(z,p=null,p))},J=()=>{ge().then(()=>{let e=document.getElementById("custom-due-date");setTimeout(()=>{e==null||e.focus()},250)})},Q=()=>{var e,m;return!((e=o==null?void 0:o.name)!=null&&e.trim())||!((m=o==null?void 0:o.interval)!=null&&m.value)||!(o!=null&&o.start_date)||!(o!=null&&o.end)},Y=()=>{let e=[];if(h||e.push("Issuer"),(!C||C.id===0)&&e.push("Customer"),(p==0||p==null&&(n==null?void 0:n.value)==0)&&e.push("Due date"),u.length===0&&e.push("Product"),We()||e.push("Payment method"),(!s||s.name==="none")&&e.push("Currency"),Q()&&e.push("Recurring"),e.length>0){const m="Please fill missing fields: "+e.join(", ")+".";return l.error(m),!1}return!0},W=e=>{if(!Y())return;_(M,d=!0,d);const m=G(Ue(),X(),Z());$(m,e.detail)},$=(e,m)=>{b&&console.log(e),r(1,D=!0),l.loading("Saving recurring invoice...");const g=!!m,S=!!U;be(`recurring/create?create-invoice=${g}&send-email=${S}`,e,c=>{l.dismiss(),r(1,D=!1),l.success("Recurring Invoice created successfully",{duration:5e3}),g&&c.data.invoiceCreated?l.success("Invoice created successfully",{duration:5e3}):g&&!c.data.invoiceCreated&&l.error("Failed to create invoice",{duration:5e3}),S&&c.data.emailSent?l.success("Invoice sent to email successfully",{duration:5e3}):S&&!c.data.emailSent&&l.error("Failed to send email",{duration:5e3}),m&&Ce(v.UNPAID.LOWER_CASE,v.ALL.LOWER_CASE),window.location.replace(`#/recurring/${c.data.clientId}/${c.data.token}`)}).catch(c=>{r(1,D=!1),je(c,"recurring invoice")})},ee=({detail:e})=>{U=e.isSendEmail,W({detail:!0})};fe(()=>{_(K,o={...o,...ze()},o)});function te(e){R=e,r(0,R)}return t.$$set=e=>{"params"in e&&r(6,f=e.params)},[R,D,V,H,W,ee,f,te]}class $t extends re{constructor(a){super(),oe(this,a,Me,Ke,ie,{params:6},null,[-1,-1])}}export{$t as default};
