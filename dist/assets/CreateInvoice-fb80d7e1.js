import{S as ne,i as ae,s as ce,a4 as y,a5 as A,c as ue,m as le,a6 as T,j as me,t as de,l as pe,X as i,Z as M,q as b,p as fe}from"./Toaster.svelte_svelte_type_style_lang-89e761ff.js";import{t as De}from"./triggerTabUpdateHelper-d930696b.js";import{c as be}from"./enum-9d62bdc6.js";import{i as ge,s as V,p as _e}from"./errorHelper-39e9d1d7.js";import{n as W,r as he,o as Se,d as Ce,b as Ie,g as ve,t as ye,f as Ae,p as Te,q as Pe,u as Fe,v as Oe,x as ke,y as Re,e as Ye,z as Be,A as Ne,h as Le,k as qe,l as we,s as X}from"./invoice-store-eba4366e.js";import{h as Me}from"./invoiceErrorHelper-d5e44338.js";import{c as Ee,s as je}from"./Options-40a61ab3.js";import{B as ze}from"./BaseCreateInvoice-a9e5214d.js";import{h as Z}from"./moment-a9aaa855.js";import"./invoice-list-store-0e2f6016.js";import"./index-99d0c2fd.js";import"./table-row-f15328e9.js";import"./card-footer-08d9ee18.js";import"./index-700ffd0e.js";import"./updater-00e9e1bb.js";import"./options-1651b5d0.js";import"./x-416feb5b.js";import"./helpers-9eb8762f.js";import"./separator-95c0d010.js";import"./MiniStar-8026f138.js";import"./input-ab223ce3.js";import"./label-e50396f8.js";import"./create-9e47477b.js";import"./Plus-3897747b.js";import"./Trash-4a47b42d.js";import"./Select-70747da0.js";import"./index-210676e1.js";import"./arrays-9d05857f.js";import"./Check-a4797a61.js";import"./action-a5acf0e9.js";import"./styles-e7e55f44.js";import"./decimalFormatter-88348579.js";import"./saveToStoreHelper-31a463b7.js";import"./MultilineText-89cdd008.js";import"./dialog-header-5fe8b5ad.js";import"./dialog-footer-37c988b6.js";import"./dialog-description-ca00c0bf.js";import"./dialog-description-624b4ce9.js";import"./customer-modal-284e029d.js";import"./switch-8efa315f.js";import"./product-modal-e47dc535.js";import"./CustomCurrencyInput-e534ba6a.js";import"./capitalHelper-77c0a756.js";import"./search-e03ceb6e.js";import"./checkbox-ac399b75.js";import"./emptyDataHelper-b583dd0c.js";import"./index-88943f30.js";import"./card-description-236c99a6.js";import"./pluralHelper-a32d0151.js";import"./add-discount-modal-079529d2.js";import"./index-838f84b3.js";import"./add-tax-modal-3fd5671f.js";import"./add-reminder-modal-0bbf6d3f.js";import"./UpgradeToProButton-1dc6d5d7.js";import"./chevron-down-2b9a232f.js";import"./main-f1d8723f.js";import"./Breadcrumb-87f5fc70.js";import"./ProBadge-06425ff7.js";import"./send-2227b51e.js";function Ue(t){let r,o,p,f,g,_,D;function P(s){t[11](s)}function F(s){t[12](s)}function O(s){t[13](s)}function k(s){t[14](s)}function R(s){t[15](s)}let a={nav:t[6],isSubmitting:t[5]};return t[1]!==void 0&&(a.selectedStatus=t[1]),t[2]!==void 0&&(a.selectedOrderDate=t[2]),t[0]!==void 0&&(a.selectedInvoiceDate=t[0]),t[3]!==void 0&&(a.selectedDueDate=t[3]),t[4]!==void 0&&(a.selectedDueDateCustom=t[4]),r=new ze({props:a}),y.push(()=>A(r,"selectedStatus",P)),y.push(()=>A(r,"selectedOrderDate",F)),y.push(()=>A(r,"selectedInvoiceDate",O)),y.push(()=>A(r,"selectedDueDate",k)),y.push(()=>A(r,"selectedDueDateCustom",R)),r.$on("submit",t[8]),r.$on("createAndSend",t[9]),r.$on("updateDueDate",t[7]),{c(){ue(r.$$.fragment)},m(s,n){le(r,s,n),D=!0},p(s,n){const c={};n[0]&32&&(c.isSubmitting=s[5]),!o&&n[0]&2&&(o=!0,c.selectedStatus=s[1],T(()=>o=!1)),!p&&n[0]&4&&(p=!0,c.selectedOrderDate=s[2],T(()=>p=!1)),!f&&n[0]&1&&(f=!0,c.selectedInvoiceDate=s[0],T(()=>f=!1)),!g&&n[0]&8&&(g=!0,c.selectedDueDate=s[3],T(()=>g=!1)),!_&&n[0]&16&&(_=!0,c.selectedDueDateCustom=s[4],T(()=>_=!1)),r.$set(c)},i(s){D||(me(r.$$.fragment,s),D=!0)},o(s){de(r.$$.fragment,s),D=!1},d(s){pe(r,s)}}}function Ve(t,r,o){let p,f,g,_,D,P,F,O,k,R,a,s,n,c,Y,E,j,z,N,L,q,C,w,l;i(t,ge,e=>o(17,p=e)),i(t,W,e=>o(18,f=e)),i(t,he,e=>o(19,g=e)),i(t,Se,e=>o(20,_=e)),i(t,Ce,e=>o(21,D=e)),i(t,Ie,e=>o(22,P=e)),i(t,ve,e=>o(23,F=e)),i(t,ye,e=>o(24,O=e)),i(t,Ae,e=>o(25,k=e)),i(t,Te,e=>o(26,R=e)),i(t,Pe,e=>o(27,a=e)),i(t,Fe,e=>o(28,s=e)),i(t,Oe,e=>o(29,n=e)),i(t,ke,e=>o(30,c=e)),i(t,Re,e=>o(31,Y=e)),i(t,Ye,e=>o(32,E=e)),i(t,Be,e=>o(33,j=e)),i(t,Ne,e=>o(34,z=e)),i(t,Le,e=>o(35,N=e)),i(t,qe,e=>o(36,L=e)),i(t,we,e=>o(37,q=e)),i(t,V,e=>o(38,C=e)),i(t,_e,e=>o(39,w=e)),i(t,X,e=>o(10,l=e));const G=[{name:"Invoice",link:"invoices"},{name:"Create",link:"invoices/create"}];let h,I,m,d,S,v,B=!1;const H=e=>{M(X,l=e.detail,l);const u=parseInt(e.detail.value);if(u===0)o(3,d=null);else{const re=u;o(3,d=Z(m).add(re,"days").format("YYYY-MM-DD")),o(4,S=null)}},J=()=>{M(V,C++,C)},K=()=>{let e=[];return q||e.push("Issuer"),L||e.push("Customer"),h||e.push("Status"),I||e.push("Order date"),m||e.push("Invoice date"),d||S||e.push("Due date"),N.length===0&&e.push("Product"),Ee()||e.push("Payment method"),(!Y||Y.name==="none")&&e.push("Currency"),!a&&!s.name&&e.push("Bill to 'name'"),e.length>0?(b.error("Please fill missing fields: "+e.join(", ")+"."),!1):!0},Q=()=>({id:w.toString()+C.toString(),prefix:w,number:C,business:q,client:L,status:h.value,orderDate:I,invoiceDate:m,dueDate:d??S,products:N,payments:je(),note:z,terms:j,internalNote:E,currency:Y,subtotal:c,total:n,billedTo:s,billedToSameAsClient:a,discount:{total:R,data:k},tax:{total:O,data:F},reminder:{before:P,after:D,forClient:_,forAdmin:g}}),U=()=>{if(!K())return;M(W,f=!0,f);const e=Q();p&&console.log(e),x(e)},x=e=>{v||(o(5,v=!0),b.loading("Saving invoice..."),fe(`invoice/create?email=${B}`,e,u=>{p&&console.log(u),b.dismiss(),b.success("Invoice created successfully",{duration:5e3}),B&&u.data.emailSent?b.success("Invoice sent to email successfully",{duration:5e3}):B&&!u.data.emailSent&&b.error("Failed to send email",{duration:5e3}),u.data.receiptCreated&&b.success("Receipt created successfully",{duration:5e3}),De(h.value,be.ALL.LOWER_CASE),J(),o(5,v=!1),window.location.replace(`#/invoice/${u.data.token}`)}).catch(u=>{o(5,v=!1),Me(u,"invoice")}))},$=()=>{B=!0,U()};function ee(e){h=e,o(1,h)}function te(e){I=e,o(2,I)}function oe(e){m=e,o(0,m)}function se(e){d=e,o(3,d),o(10,l),o(0,m)}function ie(e){S=e,o(4,S)}return t.$$.update=()=>{if(t.$$.dirty[0]&1025){const e=l==null?void 0:l.value;o(3,d=e?Z(m).add(e,"days").format("YYYY-MM-DD"):null)}},[m,h,I,d,S,v,G,H,U,$,l,ee,te,oe,se,ie]}class Jt extends ne{constructor(r){super(),ae(this,r,Ve,Ue,ce,{},null,[-1,-1])}}export{Jt as default};
