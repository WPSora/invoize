import{S as re,i as oe,s as ie,a4 as se,a5 as ne,c as ae,m as me,a6 as ue,j as ce,t as le,l as de,X as i,aK as pe,O as fe,Z as _,a3 as ge,q as l,p as be}from"./Toaster.svelte_svelte_type_style_lang-3086cbd0.js";import{t as Ce}from"./triggerTabUpdateHelper-54f25315.js";import{c as v}from"./enum-9d62bdc6.js";import{y as De,h as _e,s as x,I as z,k as he,l as Re,d as Se,b as ye,r as Ie,o as Ae,g as Be,t as Pe,f as Te,p as ke,v as Ee,x as Fe,e as Le,z as Ne,A as qe,q as we,u as Oe}from"./invoice-store-89da11de.js";import{r as K,i as M}from"./recurring-store-e654427c.js";import{h as je}from"./invoiceErrorHelper-13369b1f.js";import{s as Ue,c as We}from"./Options-60264e68.js";import{i as ve}from"./errorHelper-eef9e97b.js";import{B as xe}from"./BaseCreateRecurring-c77a39ac.js";import{g as ze}from"./setDefaultRecurring-f1d67430.js";import"./invoice-list-store-3ca58dd7.js";import"./index-2f32262e.js";import"./table-row-9bf80d0a.js";import"./card-footer-7cfda621.js";import"./index-d3c8ba18.js";import"./updater-cbd8223a.js";import"./options-89ca2928.js";import"./x-e55b9835.js";import"./helpers-9268112f.js";import"./separator-d7b15c7c.js";import"./MiniStar-4e4614b7.js";import"./input-342b31a9.js";import"./label-7d3a217f.js";import"./create-e552ce8d.js";import"./Plus-e1a813d4.js";import"./Trash-c1f21d44.js";import"./Select-aaeb8f73.js";import"./index-7095afc4.js";import"./arrays-9d05857f.js";import"./Check-fa20f0eb.js";import"./action-39728114.js";import"./styles-e7e55f44.js";import"./decimalFormatter-88348579.js";import"./saveToStoreHelper-e7988ee0.js";import"./MultilineText-07aaf54e.js";import"./dialog-header-208ee491.js";import"./dialog-footer-e40dcf9d.js";import"./dialog-description-776c5d22.js";import"./dialog-description-42b79c51.js";import"./customer-modal-96845865.js";import"./switch-b7e944c0.js";import"./product-modal-3f3c8373.js";import"./CustomCurrencyInput-d3541a18.js";import"./capitalHelper-77c0a756.js";import"./search-b20aeeac.js";import"./checkbox-3eb65d0a.js";import"./emptyDataHelper-b583dd0c.js";import"./index-4f0b7d19.js";import"./card-description-e849d062.js";import"./pluralHelper-a32d0151.js";import"./add-discount-modal-7bc175c5.js";import"./index-0984da6d.js";import"./add-tax-modal-c2b7393b.js";import"./add-reminder-modal-6c4f373e.js";import"./UpgradeToProButton-e020fdbc.js";import"./chevron-down-a8868dd9.js";import"./main-2325799b.js";import"./header-title-a9af6ef4.js";import"./Breadcrumb-8a216a28.js";import"./ProBadge-35078e4e.js";import"./plus-a3b54817.js";import"./moment-a9aaa855.js";function Ke(t){let a,r,o;function b(s){t[7](s)}let d={nav:t[2],isSubmitting:t[1]};return t[0]!==void 0&&(d.selectedDueDateBind=t[0]),a=new xe({props:d}),se.push(()=>ne(a,"selectedDueDateBind",b)),a.$on("submit",t[4]),a.$on("createInvoice",t[5]),a.$on("updateDueDate",t[3]),{c(){ae(a.$$.fragment)},m(s,u){me(a,s,u),o=!0},p(s,u){const n={};u[0]&2&&(n.isSubmitting=s[1]),!r&&u[0]&1&&(r=!0,n.selectedDueDateBind=s[0],ue(()=>r=!1)),a.$set(n)},i(s){o||(ce(a.$$.fragment,s),o=!0)},o(s){le(a.$$.fragment,s),o=!1},d(s){de(a,s)}}}function Me(t,a,r){let o,b,d,s,u,n,p,C,h,y,I,A,B,P,T,k,E,F,L,N,q,w,O,j;i(t,K,e=>r(10,o=e)),i(t,ve,e=>r(11,b=e)),i(t,M,e=>r(12,d=e)),i(t,De,e=>r(13,s=e)),i(t,_e,e=>r(14,u=e)),i(t,x,e=>r(15,n=e)),i(t,z,e=>r(16,p=e)),i(t,he,e=>r(17,C=e)),i(t,Re,e=>r(18,h=e)),i(t,Se,e=>r(19,y=e)),i(t,ye,e=>r(20,I=e)),i(t,Ie,e=>r(21,A=e)),i(t,Ae,e=>r(22,B=e)),i(t,Be,e=>r(23,P=e)),i(t,Pe,e=>r(24,T=e)),i(t,Te,e=>r(25,k=e)),i(t,ke,e=>r(26,E=e)),i(t,Ee,e=>r(27,F=e)),i(t,Fe,e=>r(28,L=e)),i(t,Le,e=>r(29,N=e)),i(t,Ne,e=>r(30,q=e)),i(t,qe,e=>r(31,w=e)),i(t,we,e=>r(32,O=e)),i(t,Oe,e=>r(33,j=e));let{params:f={}}=a;const V=[{name:"Recurring",link:"recurrings"},{name:"Create",link:""}];let R,D=!1,U=!1;pe("clientIdParam",f==null?void 0:f.clientId);const X=()=>{var e,m;return{name:o==null?void 0:o.name,interval:(e=o==null?void 0:o.interval)==null?void 0:e.value,start:o==null?void 0:o.start_date,end:(m=o==null?void 0:o.end)==null?void 0:m.value}},Z=()=>(n==null?void 0:n.value)!==0?parseInt(n==null?void 0:n.value):parseInt(p),G=(e,m,g)=>({id:m.name,business:h,billedTo:j,billedToSameAsClient:O,client:C,dueDateInterval:g,products:u,payments:e,note:w,terms:q,internalNote:N,currency:s,subtotal:L,total:F,discount:{total:E,data:k},tax:{total:T,data:P},reminder:{forClient:B,forAdmin:A,before:I,after:y},recurring:m}),H=e=>{_(x,n=e.detail,n),e.detail.value===0?J():(e.detail.value,_(z,p=null,p))},J=()=>{ge().then(()=>{let e=document.getElementById("custom-due-date");setTimeout(()=>{e==null||e.focus()},250)})},Q=()=>{var e,m;return!((e=o==null?void 0:o.name)!=null&&e.trim())||!((m=o==null?void 0:o.interval)!=null&&m.value)||!(o!=null&&o.start_date)||!(o!=null&&o.end)},Y=()=>{let e=[];if(h||e.push("Issuer"),(!C||C.id===0)&&e.push("Customer"),(p==0||p==null&&(n==null?void 0:n.value)==0)&&e.push("Due date"),u.length===0&&e.push("Product"),We()||e.push("Payment method"),(!s||s.name==="none")&&e.push("Currency"),Q()&&e.push("Recurring"),e.length>0){const m="Please fill missing fields: "+e.join(", ")+".";return l.error(m),!1}return!0},W=e=>{if(!Y())return;_(M,d=!0,d);const m=G(Ue(),X(),Z());$(m,e.detail)},$=(e,m)=>{b&&console.log(e),r(1,D=!0),l.loading("Saving recurring invoice...");const g=!!m,S=!!U;be(`recurring/create?create-invoice=${g}&send-email=${S}`,e,c=>{l.dismiss(),r(1,D=!1),l.success("Recurring Invoice created successfully",{duration:5e3}),g&&c.data.invoiceCreated?l.success("Invoice created successfully",{duration:5e3}):g&&!c.data.invoiceCreated&&l.error("Failed to create invoice",{duration:5e3}),S&&c.data.emailSent?l.success("Invoice sent to email successfully",{duration:5e3}):S&&!c.data.emailSent&&l.error("Failed to send email",{duration:5e3}),m&&Ce(v.UNPAID.LOWER_CASE,v.ALL.LOWER_CASE),window.location.replace(`#/recurring/${c.data.clientId}/${c.data.token}`)}).catch(c=>{r(1,D=!1),je(c,"recurring invoice")})},ee=({detail:e})=>{U=e.isSendEmail,W({detail:!0})};fe(()=>{_(K,o={...o,...ze()},o)});function te(e){R=e,r(0,R)}return t.$$set=e=>{"params"in e&&r(6,f=e.params)},[R,D,V,H,W,ee,f,te]}class $t extends re{constructor(a){super(),oe(this,a,Me,Ke,ie,{params:6},null,[-1,-1])}}export{$t as default};
