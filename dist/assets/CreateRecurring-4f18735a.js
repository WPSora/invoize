import{S as re,i as oe,s as ie,a4 as se,a5 as ne,c as ae,m as me,a6 as ue,j as ce,t as le,l as de,X as i,aK as pe,O as fe,Z as _,a3 as ge,r as l,q as be}from"./Toaster.svelte_svelte_type_style_lang-7f7e6c6a.js";import{t as Ce}from"./triggerTabUpdateHelper-11d76906.js";import{c as v}from"./separator-8c150833.js";import{y as De,h as _e,s as x,I as z,k as he,l as Re,d as Se,b as ye,r as Ie,o as Ae,g as Be,t as Pe,f as Te,p as ke,v as Ee,x as Fe,e as Le,z as Ne,A as qe,q as we,u as Oe}from"./invoice-store-15af1eec.js";import{r as K,i as M}from"./recurring-store-47d6cb68.js";import{h as je}from"./invoiceErrorHelper-bae2e779.js";import{s as Ue,c as We}from"./Options-037fa0e5.js";import{i as ve}from"./errorHelper-c5761fa6.js";import{B as xe}from"./BaseCreateRecurring-f382f8bf.js";import{g as ze}from"./setDefaultRecurring-f1d67430.js";import"./invoice-list-store-3c52e6c0.js";import"./updater-76d8237b.js";import"./index-8135346f.js";import"./table-row-c2593e52.js";import"./card-footer-319409b2.js";import"./index-adb69836.js";import"./options-d5ba9c63.js";import"./x-b214d010.js";import"./helpers-5c749aec.js";import"./MiniStar-2f2d4797.js";import"./input-64299b06.js";import"./label-a6e03658.js";import"./create-eb81c484.js";import"./Plus-ee972d35.js";import"./Trash-484f47e4.js";import"./Select-94066a52.js";import"./index-dc1d53ab.js";import"./arrays-9d05857f.js";import"./Check-ec98a9d8.js";import"./action-d784a92a.js";import"./styles-30db5b3b.js";import"./decimalFormatter-88348579.js";import"./saveToStoreHelper-5248b7cc.js";import"./MultilineText-1b659c34.js";import"./dialog-header-655042da.js";import"./dialog-footer-22ba1d23.js";import"./dialog-description-9fea76bb.js";import"./dialog-description-dd705748.js";import"./customer-modal-98bdf5ff.js";import"./switch-51c230fd.js";import"./product-modal-f2cbecd2.js";import"./CustomCurrencyInput-8b34c19a.js";import"./capitalHelper-77c0a756.js";import"./search-bd6b6cd8.js";import"./checkbox-f6f93199.js";import"./emptyDataHelper-b583dd0c.js";import"./index-f8fb6e4a.js";import"./card-description-64c50d70.js";import"./pluralHelper-a32d0151.js";import"./add-discount-modal-d666dc98.js";import"./index-27b43081.js";import"./add-tax-modal-8c8bff4c.js";import"./add-reminder-modal-aee7f519.js";import"./UpgradeToProButton-7ff300b6.js";import"./chevron-down-19a57459.js";import"./main-23792a0b.js";import"./header-title-bd16e1f0.js";import"./Breadcrumb-694ccbf9.js";import"./ProBadge-053dd74a.js";import"./plus-2e7ded7f.js";import"./moment-a9aaa855.js";function Ke(t){let a,r,o;function b(s){t[7](s)}let d={nav:t[2],isSubmitting:t[1]};return t[0]!==void 0&&(d.selectedDueDateBind=t[0]),a=new xe({props:d}),se.push(()=>ne(a,"selectedDueDateBind",b)),a.$on("submit",t[4]),a.$on("createInvoice",t[5]),a.$on("updateDueDate",t[3]),{c(){ae(a.$$.fragment)},m(s,u){me(a,s,u),o=!0},p(s,u){const n={};u[0]&2&&(n.isSubmitting=s[1]),!r&&u[0]&1&&(r=!0,n.selectedDueDateBind=s[0],ue(()=>r=!1)),a.$set(n)},i(s){o||(ce(a.$$.fragment,s),o=!0)},o(s){le(a.$$.fragment,s),o=!1},d(s){de(a,s)}}}function Me(t,a,r){let o,b,d,s,u,n,p,C,h,y,I,A,B,P,T,k,E,F,L,N,q,w,O,j;i(t,K,e=>r(10,o=e)),i(t,ve,e=>r(11,b=e)),i(t,M,e=>r(12,d=e)),i(t,De,e=>r(13,s=e)),i(t,_e,e=>r(14,u=e)),i(t,x,e=>r(15,n=e)),i(t,z,e=>r(16,p=e)),i(t,he,e=>r(17,C=e)),i(t,Re,e=>r(18,h=e)),i(t,Se,e=>r(19,y=e)),i(t,ye,e=>r(20,I=e)),i(t,Ie,e=>r(21,A=e)),i(t,Ae,e=>r(22,B=e)),i(t,Be,e=>r(23,P=e)),i(t,Pe,e=>r(24,T=e)),i(t,Te,e=>r(25,k=e)),i(t,ke,e=>r(26,E=e)),i(t,Ee,e=>r(27,F=e)),i(t,Fe,e=>r(28,L=e)),i(t,Le,e=>r(29,N=e)),i(t,Ne,e=>r(30,q=e)),i(t,qe,e=>r(31,w=e)),i(t,we,e=>r(32,O=e)),i(t,Oe,e=>r(33,j=e));let{params:f={}}=a;const V=[{name:"Recurring",link:"recurrings"},{name:"Create",link:""}];let R,D=!1,U=!1;pe("clientIdParam",f==null?void 0:f.clientId);const X=()=>{var e,m;return{name:o==null?void 0:o.name,interval:(e=o==null?void 0:o.interval)==null?void 0:e.value,start:o==null?void 0:o.start_date,end:(m=o==null?void 0:o.end)==null?void 0:m.value}},Z=()=>(n==null?void 0:n.value)!==0?parseInt(n==null?void 0:n.value):parseInt(p),G=(e,m,g)=>({id:m.name,business:h,billedTo:j,billedToSameAsClient:O,client:C,dueDateInterval:g,products:u,payments:e,note:w,terms:q,internalNote:N,currency:s,subtotal:L,total:F,discount:{total:E,data:k},tax:{total:T,data:P},reminder:{forClient:B,forAdmin:A,before:I,after:y},recurring:m}),H=e=>{_(x,n=e.detail,n),e.detail.value===0?J():(e.detail.value,_(z,p=null,p))},J=()=>{ge().then(()=>{let e=document.getElementById("custom-due-date");setTimeout(()=>{e==null||e.focus()},250)})},Q=()=>{var e,m;return!((e=o==null?void 0:o.name)!=null&&e.trim())||!((m=o==null?void 0:o.interval)!=null&&m.value)||!(o!=null&&o.start_date)||!(o!=null&&o.end)},Y=()=>{let e=[];if(h||e.push("Issuer"),(!C||C.id===0)&&e.push("Customer"),(p==0||p==null&&(n==null?void 0:n.value)==0)&&e.push("Due date"),u.length===0&&e.push("Product"),We()||e.push("Payment method"),(!s||s.name==="none")&&e.push("Currency"),Q()&&e.push("Recurring"),e.length>0){const m="Please fill missing fields: "+e.join(", ")+".";return l.error(m),!1}return!0},W=e=>{if(!Y())return;_(M,d=!0,d);const m=G(Ue(),X(),Z());$(m,e.detail)},$=(e,m)=>{b&&console.log(e),r(1,D=!0),l.loading("Saving recurring invoice...");const g=!!m,S=!!U;be(`recurring/create?create-invoice=${g}&send-email=${S}`,e,c=>{l.dismiss(),r(1,D=!1),l.success("Recurring Invoice created successfully",{duration:5e3}),g&&c.data.invoiceCreated?l.success("Invoice created successfully",{duration:5e3}):g&&!c.data.invoiceCreated&&l.error("Failed to create invoice",{duration:5e3}),S&&c.data.emailSent?l.success("Invoice sent to email successfully",{duration:5e3}):S&&!c.data.emailSent&&l.error("Failed to send email",{duration:5e3}),m&&Ce(v.UNPAID.LOWER_CASE,v.ALL.LOWER_CASE),window.location.replace(`#/recurring/${c.data.clientId}/${c.data.token}`)}).catch(c=>{r(1,D=!1),je(c,"recurring invoice")})},ee=({detail:e})=>{U=e.isSendEmail,W({detail:!0})};fe(()=>{_(K,o={...o,...ze()},o)});function te(e){R=e,r(0,R)}return t.$$set=e=>{"params"in e&&r(6,f=e.params)},[R,D,V,H,W,ee,f,te]}class Yt extends re{constructor(a){super(),oe(this,a,Me,Ke,ie,{params:6},null,[-1,-1])}}export{Yt as default};
