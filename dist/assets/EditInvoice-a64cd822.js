import{S as at,i as pt,s as dt,a4 as R,a5 as E,c as Dt,m as ft,a6 as W,j as bt,t as ht,l as _t,X as o,O as gt,Z as i,q as Y,p as yt,P as Ct}from"./Toaster.svelte_svelte_type_style_lang-89e761ff.js";import{i as It,v as Pt,w as vt,h as St}from"./errorHelper-39e9d1d7.js";import{r as Pe,o as ve,d as Se,b as ke,g as Be,t as kt,f as Te,p as Bt,v as Tt,x as At,y as Ae,e as Fe,z as Oe,A as Ne,h as Re,q as Ee,u as We,k as Ft,l as Ot,w as qe,B as we,C as Le,D as Me,E as Ue,F as Ye,G as Xe,j as je,H as ze,m as Ge,s as de,a as He,c as Ke}from"./invoice-store-eba4366e.js";import{b as Ve,P as X,c as Nt}from"./enum-9d62bdc6.js";import{g as Ze}from"./options-1651b5d0.js";import{c as Rt,s as Et}from"./Options-40a61ab3.js";import{t as Wt}from"./triggerTabUpdateHelper-d930696b.js";import{h as qt}from"./invoiceErrorHelper-d5e44338.js";import{B as wt}from"./BaseCreateInvoice-a9e5214d.js";import{h as De}from"./moment-a9aaa855.js";import"./updater-00e9e1bb.js";import"./index-99d0c2fd.js";import"./x-416feb5b.js";import"./table-row-f15328e9.js";import"./card-footer-08d9ee18.js";import"./index-700ffd0e.js";import"./helpers-9eb8762f.js";import"./separator-95c0d010.js";import"./MiniStar-8026f138.js";import"./input-ab223ce3.js";import"./label-e50396f8.js";import"./create-9e47477b.js";import"./Plus-3897747b.js";import"./Trash-4a47b42d.js";import"./Select-70747da0.js";import"./index-210676e1.js";import"./arrays-9d05857f.js";import"./Check-a4797a61.js";import"./action-a5acf0e9.js";import"./styles-e7e55f44.js";import"./decimalFormatter-88348579.js";import"./saveToStoreHelper-31a463b7.js";import"./MultilineText-89cdd008.js";import"./dialog-header-5fe8b5ad.js";import"./dialog-footer-37c988b6.js";import"./dialog-description-ca00c0bf.js";import"./dialog-description-624b4ce9.js";import"./customer-modal-284e029d.js";import"./switch-8efa315f.js";import"./product-modal-e47dc535.js";import"./CustomCurrencyInput-e534ba6a.js";import"./capitalHelper-77c0a756.js";import"./search-e03ceb6e.js";import"./checkbox-ac399b75.js";import"./emptyDataHelper-b583dd0c.js";import"./index-88943f30.js";import"./card-description-236c99a6.js";import"./pluralHelper-a32d0151.js";import"./add-discount-modal-079529d2.js";import"./index-838f84b3.js";import"./add-tax-modal-3fd5671f.js";import"./add-reminder-modal-0bbf6d3f.js";import"./UpgradeToProButton-1dc6d5d7.js";import"./chevron-down-2b9a232f.js";import"./invoice-list-store-0e2f6016.js";import"./main-f1d8723f.js";import"./Breadcrumb-87f5fc70.js";import"./ProBadge-06425ff7.js";import"./send-2227b51e.js";function Lt(s){let l,t,C,D,f,b,a;function h(n){s[24](n)}function q(n){s[25](n)}function _(n){s[26](n)}function w(n){s[27](n)}function L(n){s[28](n)}let p={isEdit:!0,nav:s[8],isSubmitting:s[6],selectedDueDateBind:s[4],isWoocommerce:s[7]};return s[0]!==void 0&&(p.selectedStatus=s[0]),s[1]!==void 0&&(p.selectedOrderDate=s[1]),s[2]!==void 0&&(p.selectedInvoiceDate=s[2]),s[3]!==void 0&&(p.selectedDueDate=s[3]),s[5]!==void 0&&(p.selectedDueDateCustom=s[5]),l=new wt({props:p}),R.push(()=>E(l,"selectedStatus",h)),R.push(()=>E(l,"selectedOrderDate",q)),R.push(()=>E(l,"selectedInvoiceDate",_)),R.push(()=>E(l,"selectedDueDate",w)),R.push(()=>E(l,"selectedDueDateCustom",L)),l.$on("settingsFetched",s[11]),l.$on("submit",s[10]),l.$on("updateDueDate",s[9]),{c(){Dt(l.$$.fragment)},m(n,u){ft(l,n,u),a=!0},p(n,u){const m={};u[0]&64&&(m.isSubmitting=n[6]),u[0]&16&&(m.selectedDueDateBind=n[4]),u[0]&128&&(m.isWoocommerce=n[7]),!t&&u[0]&1&&(t=!0,m.selectedStatus=n[0],W(()=>t=!1)),!C&&u[0]&2&&(C=!0,m.selectedOrderDate=n[1],W(()=>C=!1)),!D&&u[0]&4&&(D=!0,m.selectedInvoiceDate=n[2],W(()=>D=!1)),!f&&u[0]&8&&(f=!0,m.selectedDueDate=n[3],W(()=>f=!1)),!b&&u[0]&32&&(b=!0,m.selectedDueDateCustom=n[5],W(()=>b=!1)),l.$set(m)},i(n){a||(bt(l.$$.fragment,n),a=!0)},o(n){ht(l.$$.fragment,n),a=!1},d(n){_t(l,n)}}}function Mt(s,l,t){let C,D,f,b,a,h,q,_,w,L,p,n,u,m,M,B,T,A,j,z,G,H,K,V,Z,J,Q,x,$,ee,F,te,se,oe,ne;o(s,It,e=>t(31,C=e)),o(s,Pe,e=>t(32,D=e)),o(s,ve,e=>t(33,f=e)),o(s,Se,e=>t(34,b=e)),o(s,ke,e=>t(35,a=e)),o(s,Be,e=>t(20,h=e)),o(s,kt,e=>t(36,q=e)),o(s,Te,e=>t(21,_=e)),o(s,Bt,e=>t(37,w=e)),o(s,Tt,e=>t(38,L=e)),o(s,At,e=>t(39,p=e)),o(s,Ae,e=>t(40,n=e)),o(s,Fe,e=>t(41,u=e)),o(s,Oe,e=>t(42,m=e)),o(s,Ne,e=>t(43,M=e)),o(s,Re,e=>t(44,B=e)),o(s,Ee,e=>t(45,T=e)),o(s,We,e=>t(46,A=e)),o(s,Ft,e=>t(47,j=e)),o(s,Ot,e=>t(48,z=e)),o(s,qe,e=>t(49,G=e)),o(s,we,e=>t(50,H=e)),o(s,Le,e=>t(51,K=e)),o(s,Me,e=>t(52,V=e)),o(s,Ue,e=>t(53,Z=e)),o(s,Ye,e=>t(54,J=e)),o(s,Xe,e=>t(55,Q=e)),o(s,je,e=>t(56,x=e)),o(s,ze,e=>t(57,$=e)),o(s,Ge,e=>t(58,ee=e)),o(s,de,e=>t(59,F=e)),o(s,Pt,e=>t(22,te=e)),o(s,He,e=>t(60,se=e)),o(s,vt,e=>t(23,oe=e)),o(s,Ke,e=>t(61,ne=e));let{params:ie={}}=l;const Je=[{name:"Invoice",link:"invoices"},{name:"Edit",link:""}];let fe,be,re,U,v,I,g,he,P,O=!1,ce=!1,le=!1,ue=!1,_e=!1,me,ae,pe;const ge=(e,r)=>e.map(y=>!!r.find(S=>S.name===y.name)),Qe=e=>{const r={label:e.name,value:e};return r.value.isWcClient=r.value.isWcClient==="true"||r.value.isWcClient===!0,r.value.id=parseInt(r.value.id),r},xe=e=>{i(de,F=e.detail,F);const r=parseInt(e.detail.value);if(r===0)t(3,g=null);else{const y=r;t(3,g=De(I).add(y,"days").format("YYYY-MM-DD")),t(5,P=null)}},ye=e=>e==null?void 0:e.map(r=>`${r.value} ${r.interval}`),$e=(e,r)=>{const y=De(e),N=De(r),S=y.diff(N,"days");let d=Ze.find(k=>k.id===S);t(3,g=e),d||(d=Ze.find(k=>k.id===0),t(5,P=e),i(de,F={value:d.id,label:d.name},F)),t(4,he={value:d.id,label:d.name})},Ce=e=>{var y,N,S,d,k,Ie;fe=e.id,be=e.tab,i(Ge,ee=e.invoiceNumber,ee),i(ze,$={label:e.business.business_name,value:e.business},$),i(je,x=Qe(e.client),x),i(Ee,T=e.billedToSameAsClient,T),i(We,A={name:e.billedTo.name,detail:e.billedTo.detail},A),t(18,ae=ye((y=e==null?void 0:e.reminders)==null?void 0:y.before)??[]),t(19,pe=ye((N=e==null?void 0:e.reminders)==null?void 0:N.after)??[]),t(17,me=e.currency),t(0,U={label:Ve.UNPAID.toUpperCase(),value:Ve.UNPAID}),t(1,v=e.orderDate),t(2,I=e.invoiceDate),$e(e.dueDate,e.invoiceDate),i(Re,B=e.products.map(c=>({id:parseInt(c.id),name:c.name,quantity:parseInt(c.quantity),unitPrice:parseFloat(c.unitPrice),amount:parseFloat(c.amount),description:c.description,note:c.note})),B),e.payments.map(c=>{c.method===X.BANK?(i(Xe,Q=!0,Q),i(Ye,J={label:c.name,value:{name:c.name,type:c.type,detail:c.detail,currency:{name:c.currency}}},J)):c.method===X.PAYPAL?(i(Ue,Z=!0,Z),i(Me,V={label:c.type,value:{name:c.name,type:c.type}},V),i(Le,K={name:c.name,type:c.type},K)):c.method===X.XENDIT?i(we,H=!0,H):c.method==X.WOOCOMMERCE&&i(qe,G=c,G)}),i(Ne,M=e.invoiceNote.note,M),i(Oe,m=e.invoiceNote.terms,m),i(Fe,u=e.invoiceNote.internalNote,u),i(Te,_=e.discount.data,_),i(Be,h=e.tax.data,h),t(7,_e=e.isWoocommerce);const r=((S=e==null?void 0:e.reminders)==null?void 0:S.before)||((d=e==null?void 0:e.reminders)==null?void 0:d.after);i(Pe,D=((k=e==null?void 0:e.reminders)==null?void 0:k.forAdmin)??!1,D),i(ve,f=((Ie=e==null?void 0:e.reminders)==null?void 0:Ie.forClient)??r,f)},et=async()=>{try{const e=await Ct(`invoice/detail?invoizeToken=${ie.invoizeToken}`);C&&console.log(e.data),t(13,re=e.data),Ce(e.data),t(15,le=!0)}catch(e){St(e,"Failed to retrieve invoice detail")}},tt=()=>{let e=[];if(z||e.push("Issuer"),j||e.push("Customer"),v||e.push("Order date"),I||e.push("Invoice date"),g||P||e.push("Due date"),B.length===0&&e.push("Product"),Rt()||e.push("Payment method"),(!n||n.name==="none")&&e.push("Currency"),!T&&!A.name&&e.push("Bill to 'name'"),e.length>0){const r="Please fill missing fields: "+e.join(", ")+".";return Y.error(r),!1}return!0},st=()=>({business:z,client:j,orderDate:v,billedTo:A,billedToSameAsClient:T,invoiceDate:I,dueDate:g??P,products:B,payments:Et(),note:M,terms:m,internalNote:u,currency:n,subtotal:p,total:L,discount:{total:w,data:_},tax:{total:q,data:h},reminder:{before:a,after:b,forClient:f,forAdmin:D}}),ot=()=>{if(!tt())return;const e=st();C&&console.log(e),nt(e)},nt=e=>{O||(t(6,O=!0),Y.loading("Updating invoice..."),yt(`invoice/edit?id=${fe}`,e,r=>{Y.dismiss(),Y.success("Invoice updated successfully"),Wt(be,Nt.ALL.LOWER_CASE),t(6,O=!1),window.location.replace(`#/invoice/${r.data.token}`)}).catch(r=>{t(6,O=!1),qt(r,"invoice")}))},it=()=>{t(14,ce=!0)};gt(()=>{et()});function rt(e){U=e,t(0,U)}function ct(e){v=e,t(1,v)}function lt(e){I=e,t(2,I)}function ut(e){g=e,t(3,g)}function mt(e){P=e,t(5,P)}return s.$$set=e=>{"params"in e&&t(12,ie=e.params)},s.$$.update=()=>{s.$$.dirty[0]&16769024&&ce&&le&&!ue&&(i(ke,a=ae,a),i(Se,b=pe,b),i(Ae,n=me,n),i(Ke,ne=ge(oe,h),ne),i(He,se=ge(te,_),se),Ce(re),t(16,ue=!0))},[U,v,I,g,he,P,O,_e,Je,xe,ot,it,ie,re,ce,le,ue,me,ae,pe,h,_,te,oe,rt,ct,lt,ut,mt]}class Gs extends at{constructor(l){super(),pt(this,l,Mt,Lt,dt,{params:12},null,[-1,-1,-1])}}export{Gs as default};
